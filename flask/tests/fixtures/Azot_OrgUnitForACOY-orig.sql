use [I-LDS Azot]
go


declare @dateTekSmen nvarchar(23);
declare @datePredSmen nvarchar(23);
declare @dateNachMes nvarchar(23);

set @dateTekSmen = '2019-11-20 08:00:00.000';
set @datePredSmen = '2019-11-19 08:00:00.000';
set @dateNachMes = '2019-11-01 00:00:00.000';

select [SPP]
--[УК] Внешний входной контроль '37503B70-FDE0-41D5-BB2E-299500AD3F6D'
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='37503B70-FDE0-41D5-BB2E-299500AD3F6D' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime, @dateTekSmen, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as VsVhodCountTekSmen --текущая смена количество общее
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='37503B70-FDE0-41D5-BB2E-299500AD3F6D' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@dateTekSmen, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as VsVhodCountNormTekSmen --текущая смена количество нарушений
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='37503B70-FDE0-41D5-BB2E-299500AD3F6D' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime,@datePredSmen, 21)) and ([ДатаОтбора]<convert(datetime, @dateTekSmen, 21))) as VsVhodCountPredSmen --предыдущая смена количество общее
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='37503B70-FDE0-41D5-BB2E-299500AD3F6D' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@datePredSmen, 21)) and ([ДатаОтбора]<convert(datetime, @dateTekSmen, 21))) as VsVhodCountNormPredSmen --предыдущая смена количество нарушений
--,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='37503B70-FDE0-41D5-BB2E-299500AD3F6D' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime,@dateNachMes, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as VsVhodCountMonth
--,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='37503B70-FDE0-41D5-BB2E-299500AD3F6D' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@dateNachMes, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as VsVhodCountNormMonth

--[УК] Внутренний входной контроль '80B7CC64-F77C-42D9-A161-0835B581EB7C'
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='80B7CC64-F77C-42D9-A161-0835B581EB7C' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime, @dateTekSmen, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as VnVhodCountTekSmen --текущая смена количество общее
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='80B7CC64-F77C-42D9-A161-0835B581EB7C' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@dateTekSmen, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as VnVhodCountNormTekSmen --текущая смена количество нарушений
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='80B7CC64-F77C-42D9-A161-0835B581EB7C' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime,@datePredSmen, 21)) and ([ДатаОтбора]<convert(datetime, @dateTekSmen, 21))) as VnVhodCountPredSmen --предыдущая смена количество общее
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='80B7CC64-F77C-42D9-A161-0835B581EB7C' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@datePredSmen, 21)) and ([ДатаОтбора]<convert(datetime, @dateTekSmen, 21))) as VnVhodCountNormPredSmen --предыдущая смена количество нарушений
--,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='80B7CC64-F77C-42D9-A161-0835B581EB7C' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime,@dateNachMes, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as VnVhodCountMonth
--,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='80B7CC64-F77C-42D9-A161-0835B581EB7C' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@dateNachMes, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as VnVhodCountNormMonth

--[УК] Операционный контроль '60DE2BDA-5EC7-4021-A880-75BEEBBCB37E'
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='60DE2BDA-5EC7-4021-A880-75BEEBBCB37E' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime, @dateTekSmen, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as OperacCountTekSmen --текущая смена количество общее
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='60DE2BDA-5EC7-4021-A880-75BEEBBCB37E' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@dateTekSmen, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as OperacCountNormTekSmen --текущая смена количество нарушений
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='60DE2BDA-5EC7-4021-A880-75BEEBBCB37E' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime,@datePredSmen, 21)) and ([ДатаОтбора]<convert(datetime, @dateTekSmen, 21))) as OperacCountPredSmen --предыдущая смена количество общее
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='60DE2BDA-5EC7-4021-A880-75BEEBBCB37E' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@datePredSmen, 21)) and ([ДатаОтбора]<convert(datetime, @dateTekSmen, 21))) as OperacCountNormPredSmen --предыдущая смена количество нарушений
--,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='60DE2BDA-5EC7-4021-A880-75BEEBBCB37E' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime,@dateNachMes, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as OperacCountMonth
--,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='60DE2BDA-5EC7-4021-A880-75BEEBBCB37E' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@dateNachMes, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as OperacCountNormMonth

--[УК] На выходе из цеха '2B32B8B4-68E9-4FFD-9417-2A926EFCBDCE'
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='2B32B8B4-68E9-4FFD-9417-2A926EFCBDCE' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime, @dateTekSmen, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as ExitCountTekSmen --текущая смена количество общее
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='2B32B8B4-68E9-4FFD-9417-2A926EFCBDCE' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@dateTekSmen, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as ExitCountNormTekSmen --текущая смена количество нарушений
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='2B32B8B4-68E9-4FFD-9417-2A926EFCBDCE' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime,@datePredSmen, 21)) and ([ДатаОтбора]<convert(datetime, @dateTekSmen, 21))) as ExitCountPredSmen --предыдущая смена количество общее
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='2B32B8B4-68E9-4FFD-9417-2A926EFCBDCE' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@datePredSmen, 21)) and ([ДатаОтбора]<convert(datetime, @dateTekSmen, 21))) as ExitCountNormPredSmen --предыдущая смена количество нарушений
--,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='2B32B8B4-68E9-4FFD-9417-2A926EFCBDCE' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime,@dateNachMes, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as ExitCountMonth
--,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='2B32B8B4-68E9-4FFD-9417-2A926EFCBDCE' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@dateNachMes, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as ExitCountNormMonth

--[УК] Готовая продукция '18BE9309-449D-479F-B7E7-85CD4D3F8342'
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='18BE9309-449D-479F-B7E7-85CD4D3F8342' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime, @dateTekSmen, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as ProductCountTekSmen --текущая смена количество общее
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='18BE9309-449D-479F-B7E7-85CD4D3F8342' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@dateTekSmen, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as ProductCountNormTekSmen --текущая смена количество нарушений
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='18BE9309-449D-479F-B7E7-85CD4D3F8342' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime,@datePredSmen, 21)) and ([ДатаОтбора]<convert(datetime, @dateTekSmen, 21))) as ProductCountPredSmen --предыдущая смена количество общее
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='18BE9309-449D-479F-B7E7-85CD4D3F8342' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@datePredSmen, 21)) and ([ДатаОтбора]<convert(datetime, @dateTekSmen, 21))) as ProductCountNormPredSmen --предыдущая смена количество нарушений
--,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='18BE9309-449D-479F-B7E7-85CD4D3F8342' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime,@dateNachMes, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as ProductCountMonth
--,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='18BE9309-449D-479F-B7E7-85CD4D3F8342' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@dateNachMes, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as ProductCountNormMonth

--[УК] Стоки 'A45BDC32-46A1-48C7-963B-C2B7C14FF3E5'
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='A45BDC32-46A1-48C7-963B-C2B7C14FF3E5' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime, @dateTekSmen, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as WaterCountTekSmen --текущая смена количество общее
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='A45BDC32-46A1-48C7-963B-C2B7C14FF3E5' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@dateTekSmen, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as WaterCountNormTekSmen --текущая смена количество нарушений
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='A45BDC32-46A1-48C7-963B-C2B7C14FF3E5' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime,@datePredSmen, 21)) and ([ДатаОтбора]<convert(datetime, @dateTekSmen, 21))) as WaterCountPredSmen --предыдущая смена количество общее
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='A45BDC32-46A1-48C7-963B-C2B7C14FF3E5' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@datePredSmen, 21)) and ([ДатаОтбора]<convert(datetime, @dateTekSmen, 21))) as WaterCountNormPredSmen --предыдущая смена количество нарушений
--,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='A45BDC32-46A1-48C7-963B-C2B7C14FF3E5' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime,@dateNachMes, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as WaterCountMonth
--,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='A45BDC32-46A1-48C7-963B-C2B7C14FF3E5' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@dateNachMes, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as WaterCountNormMonth

--[УК] Выбросы '603440B6-B0E2-444D-93CE-E69E4CA482E3'
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='603440B6-B0E2-444D-93CE-E69E4CA482E3' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime, @dateTekSmen, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as AirCountTekSmen --текущая смена количество общее
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='603440B6-B0E2-444D-93CE-E69E4CA482E3' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@dateTekSmen, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as AirCountNormTekSmen --текущая смена количество нарушений
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='603440B6-B0E2-444D-93CE-E69E4CA482E3' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime,@datePredSmen, 21)) and ([ДатаОтбора]<convert(datetime, @dateTekSmen, 21))) as AirCountPredSmen --предыдущая смена количество общее
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='603440B6-B0E2-444D-93CE-E69E4CA482E3' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@datePredSmen, 21)) and ([ДатаОтбора]<convert(datetime, @dateTekSmen, 21))) as AirCountNormPredSmen --предыдущая смена количество нарушений
--,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='603440B6-B0E2-444D-93CE-E69E4CA482E3' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime,@dateNachMes, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as AirCountMonth
--,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='603440B6-B0E2-444D-93CE-E69E4CA482E3' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@dateNachMes, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as AirCountNormMonth

--[УК] Проведение работ повышенной опасности 'BAE6C9D9-A7DB-4BBD-B44A-6854D5796AE5'
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='BAE6C9D9-A7DB-4BBD-B44A-6854D5796AE5' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime, @dateTekSmen, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as RPOCountTekSmen --текущая смена количество общее
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='BAE6C9D9-A7DB-4BBD-B44A-6854D5796AE5' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@dateTekSmen, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as RPOCountNormTekSmen --текущая смена количество нарушений
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='BAE6C9D9-A7DB-4BBD-B44A-6854D5796AE5' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime,@datePredSmen, 21)) and ([ДатаОтбора]<convert(datetime, @dateTekSmen, 21))) as RPOCountPredSmen --предыдущая смена количество общее
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='BAE6C9D9-A7DB-4BBD-B44A-6854D5796AE5' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@datePredSmen, 21)) and ([ДатаОтбора]<convert(datetime, @dateTekSmen, 21))) as RPOCountNormPredSmen --предыдущая смена количество нарушений
--,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='BAE6C9D9-A7DB-4BBD-B44A-6854D5796AE5' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime,@dateNachMes, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as RPOCountMonth
--,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='BAE6C9D9-A7DB-4BBD-B44A-6854D5796AE5' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@dateNachMes, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as RPOCountNormMonth

--[УК] ВОЦ 'F91669F3-D181-4551-A716-C24ECE7D0E2B'
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='F91669F3-D181-4551-A716-C24ECE7D0E2B' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime, @dateTekSmen, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as VOCCountTekSmen --текущая смена количество общее
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='F91669F3-D181-4551-A716-C24ECE7D0E2B' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@dateTekSmen, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as VOCCountNormTekSmen --текущая смена количество нарушений
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='F91669F3-D181-4551-A716-C24ECE7D0E2B' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime,@datePredSmen, 21)) and ([ДатаОтбора]<convert(datetime, @dateTekSmen, 21))) as VOCCountPredSmen --предыдущая смена количество общее
,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='F91669F3-D181-4551-A716-C24ECE7D0E2B' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@datePredSmen, 21)) and ([ДатаОтбора]<convert(datetime, @dateTekSmen, 21))) as VOCCountNormPredSmen --предыдущая смена количество нарушений
--,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='F91669F3-D181-4551-A716-C24ECE7D0E2B' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and ([ДатаОтбора]>=convert(datetime,@dateNachMes, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as VOCCountMonth
--,(select count([TestResultId]) from v_Azot_TestResultACOY_YK_SPP ARTAS Where [КодГруппаТочкиКонтроля]='F91669F3-D181-4551-A716-C24ECE7D0E2B' and ([ОргструктураПуть] like '%'+AO.SPP+'%')and [ВыходЗаНорму]=1 and([ДатаОтбора]>=convert(datetime,@dateNachMes, 21)) and ([ДатаОтбора]<CURRENT_TIMESTAMP)) as VOCCountNormMonth


 from v_Azot_OrgUnitForACOY AO

where [SPP] not like 'ошибка'
group by [SPP],[nomORG]
order by [nomORG]