!function(t){function e(e){for(var n,i,o=e[0],l=e[1],d=e[2],u=0,p=[];u<o.length;u++)i=o[u],Object.prototype.hasOwnProperty.call(s,i)&&s[i]&&p.push(s[i][0]),s[i]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);for(c&&c(e);p.length;)p.shift()();return r.push.apply(r,d||[]),a()}function a(){for(var t,e=0;e<r.length;e++){for(var a=r[e],n=!0,o=1;o<a.length;o++){var l=a[o];0!==s[l]&&(n=!1)}n&&(r.splice(e--,1),t=i(i.s=a[0]))}return t}var n={},s={0:0},r=[];function i(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=n,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(a,n,function(e){return t[e]}.bind(null,n));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/static/";var o=window.webpackJsonp=window.webpackJsonp||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var d=0;d<o.length;d++)e(o[d]);var c=l;r.push([7,1]),a()}([,,function(t,e,a){},function(t,e,a){},function(t,e,a){},,function(t,e,a){t.exports=a.p+"fixtures/Паспорт-ФБ1234567-ПЯ123456.pdf"},function(t,e,a){"use strict";a.r(e);a(1);var n=a(0),s=a.n(n);a(2),a(3),a(4);console.log("Common");const r={run:function(t,e,a){try{let e,a,n=t;if(null===n)return;if(void 0===n)return;if("submit"===n.type)return n.preventDefault();if("input"===n.type)return void(n.target&&void 0!==n.target.closest&&(a=n.target.closest([".i"]),a&&a&&a.dataset.r&&a.dataset.a&&(console.log(`${a.dataset.r}, ${a.dataset.a}`),"this"===a.dataset.a?this[a.dataset.r](a):this[a.dataset.r](a.dataset.a))));if("click"===n.type){if(a=n.target.closest(["button, a"]),a){if(a.hasAttribute("disabled"))return;a.dataset.r&&(t=>{if("function"==typeof t)return!0})(this[a.dataset.r])&&this[a.dataset.r](a.dataset.a)}if("INPUT"===n.target.tagName||"TEXTAREA"===n.target.tagName)return;return void("IMG"===n.target.tagName&&n.preventDefault())}if("string"==typeof t)return void console.log(t);if("object"!=typeof t)return;if(e=t,e&&e.dataset.r&&e.dataset.a)if(console.log(`${e.dataset.r}, ${e.dataset.a}`),"this"===e.dataset.a)this[e.dataset.r](e);else try{let t=JSON.parse(e.dataset.a);this[e.dataset.r](t)}catch(t){this[e.dataset.r](e.dataset.a)}}catch(t){if(10===t.code)return void console.warn(t.message);console.error(t)}}};function i(t){return document.getElementById(t)}function o(t){this.string=t.string||"",this.method=t.method||"post",this.body=t.body,this.typeResp=t.typeResp||"json",this.credentials=t.credentials||"include",this.url=()=>"get"===this.method.toLowerCase()?t.url+this.string:t.url,this.run=()=>new Promise((t,e)=>{fetch(this.url(),{method:this.method,body:"POST"===this.method?JSON.stringify(this.body):null,headers:{"Content-Type":"application/json"}}).then(t=>"json"===this.typeResp?t.text():t[this.typeResp]()).then(t=>"json"===this.typeResp?JSON.parse(t,this.reviver):t).then(e=>{e.xdebug_message?console.warn(e.data+" in file: "+e.file+" in line: "+e.line):t(e)}).catch(t=>{e(t)})}),this.reviver=(t,e)=>null===e?"":e}let l=function(t){t instanceof HTMLElement?this.form=t:this.form=i(t),this.valid=0,this.submitButt=this.form.querySelector('button[type="submit"]'),this.inputs=this.form.querySelectorAll("textarea, input"),this.inputsAll=this.form.querySelectorAll("input, textarea, button, select"),this.data={},this.name=this.form.name};l.prototype.setDisable=function(t){for(let e in this.inputsAll)this.inputsAll.hasOwnProperty(e)&&(this.inputsAll[e].disabled=t)},l.prototype.getData=function(){let t,e={},a=this.inputs;for(let n=0;n<a.length;++n){if(t=a[n],(t.name||t.dataset.name)&&t.innerHTML)switch(t.tagName){case"P":case"DIV":case"SPAN":e[t.dataset.name]=t.innerHTML;break;case"SELECT":e[t.name||t.dataset.name]=t.value;break;case"UL":let a=t.childNodes,n=[];for(let t=0;t<a.length;++t){let e=a[t].dataset.id||a[t].dataset.name;a.hasOwnProperty(t)&&e&&(n=n.concat(e))}a.length&&(e[t.dataset.name]=n)}switch("checkbox"===t.type&&t.checked&&(e[t.name]=1),"checkbox"===t.type&&!1===t.checked&&(e[t.name]=0),"radio"===t.type&&t.checked&&(e[t.name]=t.value),"date"===t.type&&(e[t.name]=t.value),"number"===t.type&&(e[t.name]=t.value),t.type){case"text":case"password":case"email":case"textarea":"number"===t.dataset.type?e[t.name]=t.value.replace(/\s+/g,""):t.value&&(e[t.name]=t.value)}}return this.data=e,this.data};class d{constructor(t){this.url=t.url||"init.php",this.type=t.type||"GET","string"==typeof t.data?this.data=JSON.parse(t.data):this.data=t.data,this.success=t.success,this.error=t.error}runQuery(t){new o({url:this.url,body:"POST"===this.type?this.data:null,method:this.type}).run().then(t=>{var e;"function"==typeof this.success&&0===t.code?this.success(t):"function"==typeof this.error?this.error(t.errors):(e=t,console.log(e))})}}class c{constructor(t){this.form=i(t.form),this.lenSens=t.lenSens,this.btnSubmit=i(t.btnSubmit),this.inputs=t.inputs,this.errArea="",this.listeners=(t.listeners||"keypress keydown keyup").split(" "),this.valid=!1,this.listenOn=this.listenOn.bind(this)}listenOn(){this.listeners.forEach(t=>{for(let[e,a]of Object.entries(this.inputs))i(e).addEventListener(t,t=>{t.target.value.length>this.lenSens&&(this.errArea=i(a.errArea),a.regex.test(t.target.value)?(t.target.classList.remove("invalid"),this.errArea.classList.add("d-none"),this.btnSubmit.removeAttribute("disabled"),this.valid=!0):(t.target.classList.add("invalid"),this.errArea.innerHTML=a.message,this.errArea.classList.remove("d-none"),this.btnSubmit.setAttribute("disabled","disabled"),this.valid=!1))})})}}a(5),a(6);document.addEventListener("DOMContentLoaded",()=>{let t,e,a,n,o,u,p,f,h,m,b,y,v,g,w,x;n=Math.round(1e3*Math.random()),b="form"+n,o="field_1"+n,u="field_2"+n,p="field_3"+n,f="field_4"+n,h="№ накладной",m="№ вагона или контейнера",y="loader"+n,v="link"+n,w="err"+n,e="root"+n,x="btn"+n,t=i(e),t||(document.body.insertAdjacentHTML("afterbegin",`<div id="${e}"></div>`),t=i(e)),a=`<div class="container-fluid div2">\n<div class="row mx-auto">\n<h3 class="mx-auto p-3 w-100 text-center">Паспорт качества</h3>\n<h3 class="mx-auto p-3 w-100 text-center">Для получения Паспорт качества на продукцию</h3>\n<form id="${b}" class="passpq mx-auto px-4 py-2 col-12 col-sm-8 col-md-7 col-lg-6 col-xl-4">\n  <div class="form-group">\n    <label for="${o}">№ накладной</label>\n    <div class="row mx-0">\n        <input type="text" name="wagon_or_container" autofocus required class="form-control col wagon_or_container" id="${o}" aria-describedby="${p}"\n       placeholder="№ накладной" value="">\n        <div class="col-auto">\n            <button class="btn btn-secondary" type="button" data-r="clear" data-a="${o}"><i class="icon-cancel"></i></button>\n        </div>\n    </div>\n    <small id="${p}" class="form-text d-none alert alert-danger border-0 p-2 px-3 rounded-0 mt-2" role="alert">Validate this field</small>\n  </div>\n  <div class="form-group">\n    <label for="${u}">№ вагона или контейнера</label>\n    <div class="row mx-0">\n        <input type="text" required class="form-control col" id="${u}" aria-describedby="${f}"\n       placeholder="№ вагона или контейнера" value="">\n        <div class="col-auto">\n            <button class="btn btn-secondary" type="button" data-r="clear" data-a="${u}"><i class="icon-cancel"></i></button>\n        </div>\n    </div>\n    <small id="${f}" class="form-text d-none alert alert-danger border-0 p-2 px-3 rounded-0 mt-2" role="alert">Validate this field</small>\n  </div>\n  <button id="${x}" type="submit" class="btn btn-primary px-5 mx-auto d-block my-4" data-a="submit" data-r="submit">\n  <i id="${y}" class="d-none icon-spin2 animate-spin"></i>\n  <i class="icon-paper-plane"></i>\n  Получить паспорт</button>\n\n</form>\n</div></div>`,t.innerHTML=a;let $=new c({form:b,btnSubmit:x,lenSens:5,inputs:{[o]:{regex:/^([А-Я]{2,4}\d{7})$/u,errArea:p,message:"данные должны соответствовать маске АБ1234567 или АБВГ1234567"},[u]:{regex:/^([А-Я]{2}\d{6})$/u,errArea:f,message:"данные должны соответствовать маске АБ123456"}}});$.listenOn();const _={root:t,form:i(b),loader:i(y),field_1:i(o),field_2:i(u)},O={form:new l(_.form)},S={clear(t){i(t).value=""},submit(t){$.valid&&(_.field_1.value&&_.field_2.value?(O.form.setDisable(!0),_.loader.classList.remove("d-none"),s()(`#${w}`).slideUp("fast"),new d({url:"/api",type:"POST",data:{wagon_or_container:_.field_1.value,consignment:_.field_2.value},success(t){setTimeout(()=>{O.form.setDisable(!1),_.loader.classList.add("d-none"),g=`Паспорт-${_.field_1.value}-${_.field_2.value}.pdf`,t.data.is_file_exists?_.link?s()(`#${v}`).find("a").html(g).end().slideDown("fast"):(s()(_.form).append(`<div id="${v}" style="display: none;" class="alert alert-info" role="alert">\n<a class="my-4" href="http://arm-pq.web.azot.kmr/${t.data.path_to_file}"\ndownload="${t.data.path_to_file}">${g}</a></div>`),s()(`#${v}`).slideDown("fast"),_.link=i(v)):(console.log("data not found (!"),s()(_.form).append(`<div id="${w}" style="display: none;" role="alert" \nclass="alert alert-danger"><span>Запрашиваемый ${g} не найден по одной из нижеследующих причин:</br>\n<ul>\n<li>Некорректно введены данные в полях "№ накладной" и/или "№ вагона".\nПроверьте правильность данных и повторите запрос.</li>\n<li>На текущий момент ${g} не сформирован.</li>\n</ul>\n</span></div>`),s()(`#${v}`).slideUp("fast"),s()(`#${w}`).slideDown("fast"))},1e3)},error(t){setTimeout(()=>{console.log(t);let e="";for(let[a,n]of Object.entries(t))e+=`${a}: ${n}`;s()("#pq_err").html(e).slideDown("fast").delay(1500).slideUp("fast"),O.form.setDisable(!1),_.loader.classList.add("d-none")},1e3)}}).runQuery()):console.warn("empty field"))}};_.root.addEventListener("click",r.run.bind(S)),_.root.addEventListener("submit",r.run.bind(S)),console.log("arm-pq root is mount")})}]);